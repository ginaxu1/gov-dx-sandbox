openapi: 3.0.3
info:
  title: Audit Service API
  description: |
    Audit Service API for tracking and retrieving audit logs.
    
    This service provides endpoints for two distinct audit logging cases:
    
    **CASE 1: Data Exchange Auditing**
    - Creating data exchange audit logs (POST /api/data-exchange-events)
    - Retrieving data exchange audit logs (GET /api/data-exchange-events)
    - Logs data access requests from Consumer Apps to Provider Data Sources via Orchestration Engine
    
    **CASE 2: Management Portal Auditing**
    - Creating management event logs (POST /api/management-events)
    - Retrieving management event logs (GET /api/management-events)
    - Logs administrative actions (Member/Admin operations on schemas, applications, members, etc.)
    
    The service maintains a comprehensive audit trail of all data access requests
    and management operations with filtering and pagination support for admin and entity portals.
  version: 1.0.0
  contact:
    name: OpenDIF Team
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://audit-service-dev.choreo.dev
    description: Choreo Development Environment
  - url: https://audit-service.choreo.dev
    description: Choreo Production Environment
  - url: http://localhost:3001
    description: Local Development Environment

paths:
  /health:
    get:
      summary: Health Check
      description: Check if the audit service is running and healthy
      operationId: healthCheck
      tags:
        - Health
      security: []
      
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  service:
                    type: string
                    example: "audit-service"
                  status:
                    type: string
                    example: "healthy"
        '500':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: unhealthy
                  error:
                    type: string
                    example: "Service unavailable"

  /version:
    get:
      summary: Version Information
      description: Get version and build information for the audit service
      operationId: getVersion
      tags:
        - Health
      security: []
      
      responses:
        '200':
          description: Version information
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    example: "1.0.0"
                  buildTime:
                    type: string
                    example: "2024-01-15T10:30:00Z"
                  gitCommit:
                    type: string
                    example: "abc123def"
                  service:
                    type: string
                    example: "audit-service"

  /api/data-exchange-events:
    post:
      summary: Create Data Exchange Event
      description: |
        Create a data exchange audit log entry. This endpoint is called by the Orchestration Engine
        after receiving a response from each data provider during a GraphQL query federation.
        
        Each provider interaction is logged separately with:
        - Which application requested the data (applicationId)
        - Which member owns the consumer application (consumerId - optional)
        - On behalf of whom (onBehalfOfOwnerId - the citizen/data owner)
        - Which provider schema was accessed (schemaId)
        - Which member owns the provider schema (providerId - optional)
        - What data was requested (requestedData as JSON)
        - Whether the request succeeded or failed (status)
      operationId: createDataExchangeEvent
      tags:
        - Data Exchange
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDataExchangeEventRequest'
            examples:
              success_event:
                summary: Successful Data Exchange
                value:
                  timestamp: "2024-01-15T10:30:00Z"
                  status: "success"
                  applicationId: "passport-app"
                  schemaId: "hospital-schema-v1"
                  requestedData: {"fields": ["personInfo.name", "personInfo.address"]}
                  onBehalfOfOwnerId: "citizen-abc"
                  consumerId: "member-consumer-123"
                  providerId: "member-provider-456"
                  additionalInfo: {"sourceIp": "192.168.1.1"}
              failure_event:
                summary: Failed Data Exchange
                value:
                  timestamp: "2024-01-15T10:35:00Z"
                  status: "failure"
                  applicationId: "passport-app"
                  schemaId: "hospital-schema-v1"
                  requestedData: {"fields": ["personInfo.name"]}
                  onBehalfOfOwnerId: "citizen-abc"
                  consumerId: "member-consumer-123"
                  providerId: "member-provider-456"
      responses:
        '201':
          description: Data exchange event logged successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataExchangeEventResponse'
              example:
                id: "550e8400-e29b-41d4-a716-446655440000"
                timestamp: "2024-01-15T10:30:00Z"
                status: "success"
                applicationId: "passport-app"
                schemaId: "hospital-schema-v1"
                requestedData: {"fields": ["personInfo.name", "personInfo.address"]}
                onBehalfOfOwnerId: "citizen-abc"
                consumerId: "member-consumer-123"
                providerId: "member-provider-456"
                additionalInfo: {"sourceIp": "192.168.1.1"}
                createdAt: "2024-01-15T10:30:00Z"
        '400':
          description: Bad request - invalid event data (missing required fields or invalid status)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_application_id:
                  value:
                    error: "Missing required field: applicationId"
                missing_schema_id:
                  value:
                    error: "Missing required field: schemaId"
                missing_timestamp:
                  value:
                    error: "Missing required field: timestamp"
                invalid_status:
                  value:
                    error: "Invalid status. Must be 'success' or 'failure'"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get Data Exchange Events
      description: |
        Retrieve data exchange event logs with optional filtering. Supports filtering by applicationId, 
        schemaId, consumerId, providerId, status, and date range.
        
        **For Admin Portal**: Call without parameters to get all events
        **For Entity Portal (Consumer)**: Call with `?consumerId={consumerId}` to get events for a specific consumer
        **For Entity Portal (Provider)**: Call with `?providerId={providerId}` to get events for a specific provider
      operationId: getDataExchangeEvents
      tags:
        - Data Exchange
      parameters:
        - name: applicationId
          in: query
          description: Filter by application ID
          required: false
          schema:
            type: string
            example: "passport-app"
        - name: schemaId
          in: query
          description: Filter by schema ID
          required: false
          schema:
            type: string
            example: "hospital-schema-v1"
        - name: consumerId
          in: query
          description: Filter by consumer ID (member)
          required: false
          schema:
            type: string
            example: "member-consumer-123"
        - name: providerId
          in: query
          description: Filter by provider ID (member)
          required: false
          schema:
            type: string
            example: "member-provider-456"
        - name: status
          in: query
          description: Filter by status
          required: false
          schema:
            type: string
            enum: [success, failure]
            example: "success"
        - name: startDate
          in: query
          description: Filter events from this date (YYYY-MM-DD format)
          required: false
          schema:
            type: string
            format: date
            example: "2024-01-01"
        - name: endDate
          in: query
          description: Filter events until this date (YYYY-MM-DD format)
          required: false
          schema:
            type: string
            format: date
            example: "2024-12-31"
        - name: limit
          in: query
          description: Maximum number of events to return (default 50, max 1000)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
          example: 100
        - name: offset
          in: query
          description: Number of events to skip for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
      responses:
        '200':
          description: Successfully retrieved data exchange events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataExchangeEventListResponse'
              example:
                total: 2
                limit: 50
                offset: 0
                events:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    timestamp: "2024-01-15T10:30:00Z"
                    status: "success"
                    applicationId: "passport-app"
                    schemaId: "hospital-schema-v1"
                    requestedData: {"fields": ["personInfo.name", "personInfo.address"]}
                    onBehalfOfOwnerId: "citizen-abc"
                    consumerId: "member-consumer-123"
                    providerId: "member-provider-456"
                    createdAt: "2024-01-15T10:30:00Z"
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    timestamp: "2024-01-15T10:25:00Z"
                    status: "failure"
                    applicationId: "passport-app"
                    schemaId: "hospital-schema-v1"
                    requestedData: {"fields": ["personInfo.name"]}
                    consumerId: "member-consumer-123"
                    providerId: "member-provider-456"
                    createdAt: "2024-01-15T10:25:00Z"
        '400':
          description: Bad request - invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/management-events:
    post:
      summary: Create Management Event
      description: |
        Create a management event audit log entry. This endpoint is called by the Portal Backend
        when a Member or Admin performs a CREATE, UPDATE, or DELETE operation on a resource
        (schemas, applications, members, etc.), or when a service performs an operation.
        
        **Actor Types:**
        - `USER`: Member or Admin performing an action (requires `actor.id` and `actor.role`)
        - `SERVICE`: Service-to-service operation (e.g., Portal Backend calling PDP) (no `actor.id` or `actor.role`)
        
        **Event Types:**
        - `CREATE`: Creating a new resource
        - `UPDATE`: Updating an existing resource
        - `DELETE`: Deleting a resource
        - `READ`: Reading a resource (optional, may be skipped for performance)
      operationId: createManagementEvent
      tags:
        - Management Events
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateManagementEventRequest'
            examples:
              user_create_schema:
                summary: User Creates Schema
                value:
                  timestamp: "2024-01-15T10:30:00Z"
                  eventType: "CREATE"
                  status: "success"
                  actor:
                    type: "USER"
                    id: "user-123"
                    role: "ADMIN"
                  target:
                    resource: "SCHEMAS"
                    resourceId: "schema-456"
              user_update_application:
                summary: User Updates Application
                value:
                  timestamp: "2024-01-15T10:30:00Z"  
                  eventType: "UPDATE"
                  status: "success"
                  actor:
                    type: "USER"
                    id: "user-456"
                    role: "MEMBER"
                  target:
                    resource: "APPLICATIONS"
                    resourceId: "app-789"
                  metadata:
                    oldValue: "old-app-name"
                    newValue: "new-app-name"
              service_policy_update:
                summary: Service Updates Policy Metadata
                value:
                  timestamp: "2024-01-15T10:30:00Z"
                  eventType: "UPDATE"
                  status: "success"
                  actor:
                    type: "SERVICE"
                  target:
                    resource: "POLICY-METADATA"
                    resourceId: "schema-123"
      responses:
        '201':
          description: Management event created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagementEvent'
              example:
                id: "550e8400-e29b-41d4-a716-446655440000"
                eventType: "CREATE"
                status: "success"
                timestamp: "2024-01-15T10:30:00Z"
                actorType: "USER"
                actorId: "user-123"
                actorRole: "ADMIN"
                targetResource: "SCHEMAS"
                targetResourceId: "schema-456"
                metadata: null
                createdAt: "2024-01-15T10:30:00Z"
        '400':
          description: Bad request - invalid event data (missing required fields, invalid enums)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_event_type:
                  value:
                    error: "Missing required field: eventType"
                missing_actor_role:
                  value:
                    error: "Missing required field: actor.role (required when actor.type is USER)"
                invalid_event_type:
                  value:
                    error: "Invalid eventType. Must be CREATE, UPDATE, DELETE, or READ"
                invalid_target_resource:
                  value:
                    error: "Invalid target.resource: INVALID-RESOURCE"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get Management Events
      description: |
        Retrieve management event logs with optional filtering. Supports filtering by event type,
        actor type, target resource, and date range.
        
        **Use Cases:**
        - Admin Portal: View all management events across all users
        - Member Portal: Filter by specific actor to see own actions
        - Audit Reports: Filter by target resource to see all changes to a specific resource
      operationId: getManagementEvents
      tags:
        - Management Events
      parameters:
        - name: eventType
          in: query
          description: Filter events by event type
          required: false
          schema:
            type: string
            enum: [CREATE, UPDATE, DELETE]
            example: "CREATE"
        - name: status
          in: query
          description: Filter events by status
          required: false
          schema:
            type: string
            enum: [success, failure]
            example: "success"
        - name: actorType
          in: query
          description: Filter events by actor type
          required: false
          schema:
            type: string
            enum: [USER, SERVICE]
            example: "USER"
        - name: actorId
          in: query
          description: Filter events by actor ID (user ID)
          required: false
          schema:
            type: string
            example: "user-123"
        - name: actorRole
          in: query
          description: Filter events by actor role
          required: false
          schema:
            type: string
            enum: [MEMBER, ADMIN]
            example: "ADMIN"
        - name: targetResource
          in: query
          description: Filter events by target resource type
          required: false
          schema:
            type: string
            enum: [MEMBERS, SCHEMAS, SCHEMA-SUBMISSIONS, APPLICATIONS, APPLICATION-SUBMISSIONS, POLICY-METADATA]
            example: "SCHEMAS"
        - name: targetResourceId
          in: query
          description: Filter events by target resource ID
          required: false
          schema:
            type: string
            example: "schema-456"
        - name: startDate
          in: query
          description: Filter events from this date (YYYY-MM-DD format)
          required: false
          schema:
            type: string
            format: date
            example: "2024-01-01"
        - name: endDate
          in: query
          description: Filter events until this date (YYYY-MM-DD format)
          required: false
          schema:
            type: string
            format: date
            example: "2024-12-31"
        - name: limit
          in: query
          description: Maximum number of events to return (default 50, max 1000)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
          example: 100
        - name: offset
          in: query
          description: Number of events to skip for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
      responses:
        '200':
          description: Successfully retrieved management events
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagementEventResponse'
              examples:
                all_events:
                  summary: All Events
                  value:
                    events:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        eventType: "CREATE"
                        status: "success"
                        timestamp: "2024-01-15T10:30:00Z"
                        actorType: "USER"
                        actorId: "user-123"
                        actorRole: "ADMIN"
                        targetResource: "SCHEMAS"
                        targetResourceId: "schema-456"
                        metadata: null
                        createdAt: "2024-01-15T10:30:00Z"
                      - id: "550e8400-e29b-41d4-a716-446655440002"
                        eventType: "UPDATE"
                        status: "success"
                        timestamp: "2024-01-15T10:25:00Z"
                        actorType: "SERVICE"
                        actorId: null
                        actorRole: null
                        targetResource: "POLICY-METADATA"
                        targetResourceId: "schema-789"
                        metadata: null
                        createdAt: "2024-01-15T10:25:00Z"
                    total: 2
                    limit: 50
                    offset: 0
                filtered_events:
                  summary: Filtered by Event Type
                  value:
                    events:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        eventType: "CREATE"
                        status: "success"
                        timestamp: "2024-01-15T10:30:00Z"
                        actorType: "USER"
                        actorId: "user-123"
                        actorRole: "ADMIN"
                        targetResource: "SCHEMAS"
                        targetResourceId: "schema-456"
                        metadata: null
                        createdAt: "2024-01-15T10:30:00Z"
                    total: 1
                    limit: 50
                    offset: 0
        '400':
          description: Bad request - invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/audit-logs:
    post:
      summary: Create Audit Log
      description: |
        Create a generalized audit log entry suitable for distributed tracing.
        This endpoint is used by various microservices (OE, PDP, CE, Provider) to log
        key events in a request flow.
      operationId: createAuditLog
      tags:
        - Audit Logs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAuditLogRequest'
      responses:
        '201':
          description: Audit log created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLog'
        '400':
          description: Bad request - missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get Audit Logs
      description: |
        Retrieve audit logs for a specific flow using the trace ID.
        Returns a time-ordered list of events associated with that trace.
      operationId: getAuditLogs
      tags:
        - Audit Logs
      parameters:
        - name: traceId
          in: query
          description: The global trace ID to filter by
          required: true
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Successfully retrieved audit logs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditLog'
        '400':
          description: Missing traceId parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid request parameters"
        code:
          type: string
          description: Error code
          example: "INVALID_PARAMETERS"
        details:
          type: object
          description: Additional error details
          additionalProperties: true
      required:
        - error

    CreateDataExchangeEventRequest:
      type: object
      description: |
        Data exchange event request structure - sent by Orchestration Engine.
        
        **Required Fields:**
        - `timestamp`: ISO 8601 timestamp when the event occurred
        - `status`: Whether the request succeeded or failed ("success" or "failure") 
        - `applicationId`: The consumer application that made the request
        - `schemaId`: The provider schema that was accessed
        - `requestedData`: JSON object containing the requested data/fields
        
        **Optional Fields:**
        - `consumerId`: The member ID who owns the consumer application
        - `providerId`: The member ID who owns the provider schema
        - `onBehalfOfOwnerId`: Citizen ID (data owner) on whose behalf the data is requested
        - `additionalInfo`: Additional context as JSON
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the event occurred
          example: "2024-01-15T10:30:00Z"
        status:
          type: string
          enum: [success, failure]
          description: Whether the data exchange request succeeded or failed
          example: "success"
        applicationId:
          type: string
          description: Consumer application ID (e.g., "passport-app")
          example: "passport-app"
        schemaId:
          type: string
          description: Provider schema ID that was accessed
          example: "hospital-schema-v1"
        requestedData:
          type: object
          description: JSON object containing the requested data/fields
          example:
            fields: ["personInfo.name", "personInfo.address"]
        onBehalfOfOwnerId:
          type: string
          nullable: true
          description: Citizen ID (data owner) on whose behalf the data is requested
          example: "citizen-abc"
        consumerId:
          type: string
          nullable: true
          description: Member ID who owns the consumer application
          example: "member-consumer-123"
        providerId:
          type: string
          nullable: true
          description: Member ID who owns the provider schema
          example: "member-provider-456"
        additionalInfo:
          type: object
          nullable: true
          description: Additional context as JSON
          example:
            sourceIp: "192.168.1.1"
      required:
        - timestamp
        - status
        - applicationId
        - schemaId
        - requestedData

    DataExchangeEventResponse:
      type: object
      description: Data exchange event response structure
      properties:
        id:
          type: string
          format: uuid
          description: Unique database identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the event occurred
          example: "2024-01-15T10:30:00Z"
        status:
          type: string
          enum: [success, failure]
          description: Whether the data exchange request succeeded or failed
          example: "success"
        applicationId:
          type: string
          description: Consumer application ID 
          example: "passport-app"
        schemaId:
          type: string
          description: Provider schema ID that was accessed
          example: "hospital-schema-v1"
        requestedData:
          type: object
          description: JSON object containing the requested data/fields
          example:
            fields: ["personInfo.name", "personInfo.address"]
        onBehalfOfOwnerId:
          type: string
          nullable: true
          description: Citizen ID (data owner) on whose behalf the data is requested
          example: "citizen-abc"
        consumerId:
          type: string
          nullable: true
          description: Member ID who owns the consumer application
          example: "member-consumer-123"
        providerId:
          type: string
          nullable: true
          description: Member ID who owns the provider schema
          example: "member-provider-456"
        additionalInfo:
          type: object
          nullable: true
          description: Additional context as JSON
          example:
            sourceIp: "192.168.1.1"
        createdAt:
          type: string
          format: date-time
          description: When the record was created in the database
          example: "2024-01-15T10:30:00Z"
      required:
        - id
        - timestamp
        - status
        - applicationId
        - schemaId
        - requestedData
        - createdAt

    DataExchangeEventListResponse:
      type: object
      description: Paginated list response for data exchange events
      properties:
        total:
          type: integer
          format: int64
          description: Total number of events matching the filter
          example: 150
        limit:
          type: integer
          description: Maximum number of events returned
          example: 50
        offset:
          type: integer
          description: Number of events skipped for pagination
          example: 0
        events:
          type: array
          items:
            $ref: '#/components/schemas/DataExchangeEventResponse'
      required:
        - total
        - limit
        - offset
        - events

    CreateManagementEventRequest:
      type: object
      description: Management event request structure - sent by Portal Backend
      properties:
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the event occurred
          example: "2024-01-15T10:30:00Z"
        eventType:
          type: string
          enum: [CREATE, UPDATE, DELETE]
          description: Type of event/operation performed
          example: "CREATE"
        status:
          type: string
          enum: [success, failure]
          description: Whether the operation succeeded or failed
          example: "success"
        actor:
          $ref: '#/components/schemas/Actor'
        target:
          $ref: '#/components/schemas/Target'
        metadata:
          type: object
          nullable: true
          description: Optional additional context (e.g., old values, new values for UPDATE operations)
          additionalProperties: true
          example:
            oldValue: "old-schema-name"
            newValue: "new-schema-name"
      required:
        - timestamp
        - eventType
        - status
        - actor
        - target

    Actor:
      type: object
      description: Actor who performed the action
      properties:
        type:
          type: string
          enum: [USER, SERVICE]
          description: Type of actor
          example: "USER"
        id:
          type: string
          nullable: true
          description: User ID (required if type is USER, null if type is SERVICE)
          example: "user-123"
        role:
          type: string
          enum: [MEMBER, ADMIN]
          nullable: true
          description: User role (required if type is USER, null if type is SERVICE)
          example: "ADMIN"
      required:
        - type

    Target:
      type: object
      description: Resource that was acted upon
      properties:
        resource:
          type: string
          enum: [MEMBERS, SCHEMAS, SCHEMA-SUBMISSIONS, APPLICATIONS, APPLICATION-SUBMISSIONS, POLICY-METADATA]
          description: Type of resource
          example: "SCHEMAS"
        resourceId:
          type: string
          nullable: true
          description: ID of the resource (can be null for CREATE failures)
          example: "schema-456"
      required:
        - resource

    ManagementEvent:
      type: object
      description: Management event response structure
      properties:
        id:
          type: string
          format: uuid
          description: Primary key (database ID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        eventType:
          type: string
          enum: [CREATE, UPDATE, DELETE]
          description: Type of event/operation performed
          example: "CREATE"
        status:
          type: string
          enum: [success, failure]
          description: Whether the operation succeeded or failed
          example: "success"
        timestamp:
          type: string
          format: date-time
          description: When the event occurred
          example: "2024-01-15T10:30:00Z"
        actorType:
          type: string
          enum: [USER, SERVICE]
          description: Type of actor
          example: "USER"
        actorId:
          type: string
          nullable: true
          description: User ID (null if SERVICE type)
          example: "user-123"
        actorRole:
          type: string
          enum: [MEMBER, ADMIN]
          nullable: true
          description: User role (null if SERVICE type)
          example: "ADMIN"
        targetResource:
          type: string
          enum: [MEMBERS, SCHEMAS, SCHEMA-SUBMISSIONS, APPLICATIONS, APPLICATION-SUBMISSIONS, POLICY-METADATA]
          description: Type of resource that was acted upon
          example: "SCHEMAS"
        targetResourceId:
          type: string
          nullable: true
          description: ID of the resource that was acted upon (can be null for CREATE failures)
          example: "schema-456"
        metadata:
          type: object
          nullable: true
          description: Additional context stored as JSONB
          additionalProperties: true
          example:
            oldValue: "old-schema-name"
            newValue: "new-schema-name"
        createdAt:
          type: string
          format: date-time
          description: When the record was created in the database
          example: "2024-01-15T10:30:00Z"
      required:
        - id
        - eventType
        - status
        - timestamp
        - actorType
        - targetResource
        - createdAt

    ManagementEventResponse:
      type: object
      description: Response structure for GET /api/management-events
      properties:
        events:
          type: array
          items:
            $ref: '#/components/schemas/ManagementEvent'
        total:
          type: integer
          format: int64
          description: Total number of events matching the filter
          example: 150
        limit:
          type: integer
          description: Maximum number of events returned
          example: 50
        offset:
          type: integer
          description: Number of events skipped for pagination
          example: 0
      required:
        - events
        - total
        - limit
        - offset

    CreateAuditLogRequest:
      type: object
      description: Request payload for creating a generic audit log
      properties:
        traceId:
          type: string
          format: uuid
          description: Global trace ID for distributed requests
          example: "550e8400-e29b-41d4-a716-446655440000"
        timestamp:
          type: string
          format: date-time
          description: Time of event (optional, defaults to now)
          example: "2024-01-20T10:00:00Z"
        sourceService:
          type: string
          description: Service reporting the event
          example: "orchestration-engine"
        targetService:
          type: string
          description: Target service being called
          example: "pdp"
        eventType:
          type: string
          description: Type of event
          example: "POLICY_CHECK"
        status:
          type: string
          enum: [SUCCESS, FAILURE]
          description: Outcome of the event
          example: "SUCCESS"
        actorId:
          type: string
          description: ID of the actor (user or system)
          example: "user-123"
        resources:
          type: object
          description: JSON object describing affected resources
          example:
            schemaId: "schema-123"
        metadata:
          type: object
          description: JSON object for additional context
          example:
            policyId: "policy-456"
      required:
        - traceId
        - sourceService
        - eventType
        - status

    AuditLog:
      type: object
      description: Generalized audit log entry
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        traceId:
          type: string
          format: uuid
          description: Global trace ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        timestamp:
          type: string
          format: date-time
          description: Time of event
          example: "2024-01-20T10:00:00Z"
        sourceService:
          type: string
          description: Service reporting the event
          example: "orchestration-engine"
        targetService:
          type: string
          description: Target service
          example: "pdp"
        eventType:
          type: string
          description: Event type
          example: "POLICY_CHECK"
        status:
          type: string
          enum: [SUCCESS, FAILURE]
          description: Status
          example: "SUCCESS"
        actorId:
          type: string
          description: Actor ID
          example: "user-123"
        resources:
          type: object
          description: Resources info
        metadata:
          type: object
          description: Additional metadata
        createdAt:
          type: string
          format: date-time
          description: Record creation time
      required:
        - id
        - traceId
        - timestamp
        - sourceService
        - eventType
        - status

tags:
  - name: Health
    description: Health check endpoints

  - name: Data Exchange
    description: Data exchange audit logging - called by Orchestration Engine
  - name: Management Events
    description: Management portal audit logging - called by Portal Backend
  - name: Audit Logs
    description: General purpose distributed audit logging

